{
  "metadata": {
    "id": "canonical-ruleset",
    "version": "2026-02-22.05",
    "description": "Canonical governance rule catalog used for policy and drift checks.",
    "generated_from": [
      ".github/policies/agent-governance.json",
      "docs/AGENT_RULES.md"
    ],
    "lineage": {
      "policy_required_ids_sha256": "d7ffe3af9b25160f0201e7d1e9bfbdb6e51969add8d4dab43daf16229154e5b0",
      "policy_orchestrator_rules_sha256": "a31ce819cfd0b80dcafe5e2a98b01ec459980d725e5566dce3759214e3ee913f",
      "rules_doc_catalog_sha256": "62689f914d535cadfd31d2dd9ab1a1d4bc18ecd2254695a191a212ce7e5d8ce1",
      "canonical_rules_sha256": "c1c4b0f18f37157b863e44c51e6ef16b97b764ed9840a048600a55f46dc916f6"
    }
  },
  "rules": [
    {
      "id": "rule_startup_read_order",
      "statement": "Follow startup read order and run session preflight before non-trivial implementation.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_context_index_usage",
      "statement": "Use `docs/CONTEXT_INDEX.json` as the machine-readable map for context lookup.",
      "category": "docs",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_execution_queue_required",
      "statement": "Maintain canonical machine-readable execution queue in `.agents/EXECUTION_QUEUE.json`.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_plan_before_execution",
      "statement": "Plan all execution work into queue entries before changing any entry to active execution state.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_single_source_of_truth",
      "statement": "Use `.agents/EXECUTION_QUEUE.json` as the only queue/scope authority across orchestrator and subagents.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_scoped_context_read",
      "statement": "Read only queue fields/items relevant to the active feature/item scope to preserve context efficiency.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_archive_on_complete",
      "statement": "Move completed task/feature work from hot queue into feature-sharded archive artifacts.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_scope_tight_no_overbroad_refactor",
      "statement": "Keep changes narrowly scoped unless the user explicitly requests broad refactors.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_hybrid_machine_human_contract",
      "statement": "Use machine-readable contracts as authority with concise human nuance addenda when needed.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_policy_sync_required",
      "statement": "When process expectations change, update policy + enforcement + human docs together.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_continuity_required",
      "statement": "Read and maintain `.agents/CONTINUITY.md` as canonical continuity context.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_post_compaction_rebootstrap",
      "statement": "Treat compaction recovery as full startup and run preflight.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_repo_index_preflight_gate",
      "statement": "Require preflight index readiness checks (always re-index, then strict verify) before implementation starts.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_context_index_drift_guard",
      "statement": "Keep `docs/CONTEXT_INDEX.json` synchronized with policy/documentation contracts and fail checks on drift.",
      "category": "docs",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_canonical_ruleset_contract_required",
      "statement": "Maintain canonical rule IDs/statements in `contracts/rules/canonical-ruleset.json` with hash lineage tied to policy and rules docs.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_local_rule_overrides_contract_required",
      "statement": "Allow local-only override IDs only through `.agent-overrides/rule-overrides.json`, validated against `.agent-overrides/rule-overrides.schema.json`.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_canonical_agents_root",
      "statement": "Treat `.agents` as the canonical project-local agent-context path; bootstrap defaults to external workfiles mode where `.agents` symlinks to `<agents-workfiles-path>/<project-id>` (default path `../agents-workfiles`), and local `.agents` mode is explicit via `--agents-mode local`.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_worktree_root_required",
      "statement": "Keep all non-primary Git worktrees under `.worktrees`.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_agents_semantic_merge_required",
      "statement": "`.agents/**` is shared multi-session state; every `.agents/**` edit must be semantically merged against latest on-disk state.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_tdd_default",
      "statement": "Prefer true TDD and document deviations when strict TDD is impractical.",
      "category": "quality",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_coverage_default_100",
      "statement": "Treat 100% coverage as default bar unless user-approved exception exists.",
      "category": "quality",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_scope_completeness_gate",
      "statement": "Explicitly map outcomes to all in-scope user requests before closeout.",
      "category": "quality",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_feature_index_required",
      "statement": "Maintain `docs/FEATURE_INDEX.json` as the canonical machine-readable feature map.",
      "category": "docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_test_matrix_required",
      "statement": "Maintain `docs/TEST_MATRIX.md` as the canonical targeted test-command matrix.",
      "category": "docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_release_notes_template_required",
      "statement": "Enforce canonical release-notes template + generator workflow, section order, and plain-English non-jargon summaries through policy checks.",
      "category": "release",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_release_notes_changelog_source_required",
      "statement": "Treat `CHANGELOG.md` as release-notes source of truth and rotate `Unreleased` during `release:prepare`.",
      "category": "release",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_logging_contract_required",
      "statement": "Maintain `docs/LOGGING_STANDARDS.md` and enforce logging compliance checks across frontend/backend/python runtime code.",
      "category": "logging",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "orch_hybrid_instruction_contract",
      "statement": "Use a hybrid instruction contract: machine-readable payload plus concise human-readable intent/nuance.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_scope_tightness",
      "statement": "Keep delegated work and resulting diffs tightly scoped to the user request; no overbroad refactors unless explicitly requested.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_machine_payload_authoritative",
      "statement": "Treat the machine-readable payload as authoritative for execution; resolve conflicts with prose before proceeding.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_delegate_substantive_work",
      "statement": "Preserve orchestrator context by delegating substantive implementation/investigation tasks whenever delegation is available.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_operator_subagent_default",
      "statement": "Default to operator/subagent delegation for non-trivial work; direct single-agent execution is allowed only for trivial tasks.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_human_nuance_addendum",
      "statement": "When nuances are not fully captured by machine-readable fields, include concise human-language addenda.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_atomic_task_delegation",
      "statement": "Delegate work in atomic task slices so each subagent context remains narrow and auditable.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_dual_channel_result_envelope",
      "statement": "Require subagent output in two channels: machine-readable result envelope plus concise human-readable summary.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_orchestrator_coordination_only",
      "statement": "Limit orchestrator direct execution to coordination/meta tasks; if delegation is infeasible, record explicit rationale first.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_default_cli_routing",
      "statement": "Default subagent orchestration mapping is Codex agents via `codex` CLI and Claude agents via `claude` CLI unless user-overridden.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": true,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_unconfirmed_unknowns",
      "statement": "Mark unknowns explicitly as `UNCONFIRMED` and fail fast on missing required fields.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_atomic_single_objective_scope",
      "statement": "Each delegated subagent task must target exactly one concrete objective with explicit atomic_scope boundaries; split multi-objective requests into separate tasks.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_single_orchestrator_authority",
      "statement": "Use exactly one orchestrator context owner per session; subagents execute delegated work and must not recursively orchestrate.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_concise_subagent_briefs",
      "statement": "Keep subagent machine payloads and human addenda concise, bounded by configured verbosity budgets.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_spec_refined_plan_verbosity",
      "statement": "Apply concise verbosity budgets across spec outline, refined spec, and detailed implementation plan artifacts.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_codex_model_default",
      "statement": "Default model routing is role/risk-based: orchestrator uses `gpt-5.3-codex` with `xhigh`, subagents use `gpt-5.3-codex` with `high`, and Spark is reserved for low-risk loops with explicit verification commands.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": true,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "rule_route_map_required",
      "statement": "Maintain `docs/ROUTE_MAP.md` as the canonical generated backend/frontend route map.",
      "category": "docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_domain_readmes_required",
      "statement": "Maintain per-domain start-here READMEs in `backend/src/routes`, `backend/src/services`, and `frontend/features/*`.",
      "category": "docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_jsdoc_coverage_required",
      "statement": "Maintain `docs/JSDOC_COVERAGE.md` as the generated exported-symbol documentation drift tracker.",
      "category": "docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    }
  ]
}
